# ADR 0001: ピーク年齢の計算方法

Date: 2025-01-25
Status: Accepted

## Context

人口ピラミッドで「最も人口が多い年齢層」を示す「ピーク年齢」の計算方法を決定する必要があった。

当初の実装では、各年で「その時点での最大人口の年齢」を計算していたが、これだと年が進むにつれてピーク年齢が突然別のコホートに飛ぶ問題が発生した（例: 2060年→2061年で86才→64才）。

元資料（5年メモ）では、同じコホート（団塊ジュニア世代）を追跡する形でピーク年齢を表示していた。

## Decision

1. **初年で5年ローリング合計の最大を求める**
   - 45-49歳が最大なら、ピーク年齢は49才（階級の上限）
   
2. **その後はコホート追跡**
   - 初年のピーク年齢を基準に、年が進むごとに+1才
   - 2020年に49才 → 2030年に59才 → 2040年に69才 ...

3. **追加のコホート線は別途指定可能**
   - `--cohort-birth-years 1947,1971` で任意の出生年を追跡

## Consequences

### Positive
- 同じ世代を追い続けるので、人口減少の様子が直感的にわかる
- 元資料と同じ見せ方になる

### Negative
- 初年の選び方によってピーク年齢が変わる
- データ範囲外（例: 2070年に99才）になると表示が見切れる可能性

### Neutral
- コホート追跡と毎年最大計算は引数で切り替え可能

## Alternatives considered

| 選択肢 | Pros | Cons | 却下理由 |
|--------|------|------|----------|
| 毎年最大を計算 | その年の実態を反映 | 年が進むとピーク年齢が飛ぶ | ユーザー混乱 |
| 固定年齢 | シンプル | 意味がない | 不採用 |
| 複数コホートを全部表示 | 情報量が多い | 見づらい | オプションとして追加 |
